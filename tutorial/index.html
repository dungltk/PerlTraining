<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <title></title>
    <link href="http://fonts.googleapis.com/css?family=Open+Sans:regular,semibold,italic,italicsemibold|PT+Sans:400,700,400italic,700italic|PT+Serif:400,700,400italic,700italic" rel="stylesheet" />
    <link href="css/impress.css" rel="stylesheet" />
    <script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>
</head>
<body>
<div id="impress" class="impress-not-supported">
    <div class="fallback-message">
        <p>Your browser <b>doesn't support the features required</b> by impress.js, so you are presented with a simplified version of this presentation.</p>
        <p>For the best experience please use the latest <b>Chrome</b> or <b>Safari</b> browser. Firefox 10 (to be released soon) will also handle it.</p>
    </div>

<div id="title" data-y="0" data-x="0" class="step">
<h1>Perl 研修</h1>

</div>
<div data-y="0" class="step" data-x="1200">
<h2>Agenda</h2>

<ul>
<li>はじめに</li>
<li>Perl について</li>
<li>package / モジュール</li>
<li>Perl の代表的モジュール</li>
<li>Perl の環境系のしくみ</li>
</ul>

</div>
<div class="step" data-x="2400" data-y="0">
<h2>はじめに</h2>

<ul>
<li>プログラミングの基礎知識がある前提で話します</li>
<li>時間もそれほど無いので，細かい説明はできませんが，質問があればいつでもどうぞ</li>
</ul>

</div>
<div data-y="0" class="step" data-x="3600">
<h2>実習の進め方</h2>

<ul>
<li>Perl の講習に課題で手を動かしながら進めます</li>
<li>課題は PerlTraining のレポジトリにあるのでそれをやっていきます</li>
<li>practice ディレクトリ以下に課題を用意してあります</li>
</ul>

</div>
<div data-y="0" class="step" data-x="4800">
<h1>Perl について</h1>

<ul>
<li>最新版は perl 5.20.2</li>
<li>最近は毎年マイナバージョンをリリースしてる<br />(今年は5.22がでます)</li>
<li>Perl6 は Perl5 の姉妹言語(別の言語)</li>
</ul>

</div>
<div data-y="800" data-x="0" class="step">
<h1>package</h1>

</div>
<div id="package" data-y="800" class="step" data-x="1200">
<h2>package とは</h2>

<!-- id="package" -->

<ul>
<li>Perl における名前空間です</li>
<li>サブルーチンや変数のグループを作るのに使います</li>
<li>サブルーチンや変数などは必ずどこかの名前空間に紐付きます</li>
</ul>

</div>
<div class="step" data-x="2400" data-y="800">
<h2>package の宣言</h2>

<ul>
<li>下記のように宣言します</li>
<li><p>package の区切りは::(ダブルコロン)です</p>

<pre><code>package Some::Module;
</code></pre></li>
</ul>

</div>
<div class="step" data-x="3600" data-y="800">
<h2>モジュール</h2>

</div>
<div id="module" data-y="800" class="step" data-x="4800">
<h2>モジュールとは</h2>

<!-- id="module" -->

<ul>
<li>package の中身を定義しているファイル</li>
<li>package 名に対応したパス・ファイル名で保存します</li>
<li><p>ファイル最後の評価値は真であることが必要です</p>

<pre><code>package Some::Module; # ➡ Some/Module.pm
use strict;
use warnings;
1;
</code></pre></li>
</ul>

</div>
<div class="step" data-x="0" data-y="1600">
<h2>モジュールの呼び出し</h2>

<ul>
<li>use を使います</li>
<li><p>名前からパス・ファイル名を判別して，ファイルが読み込まれます</p>

<pre><code>use Some::Module;
</code></pre></li>
</ul>

</div>
<div class="step" data-x="1200" data-y="1600">
<h2>課題1</h2>

<ul>
<li>moduleの作成</li>
</ul>

</div>
<div data-x="2400" class="step" data-y="1600">
<h2>その前に</h2>

</div>
<div data-y="1600" data-x="3600" class="step">
<h2>課題レポジトリ clone</h2>

<ul>
<li>https://github.com/mixi-inc/PerlTraining</li>
<li>git clone してください</li>
</ul>

</div>
<div data-y="1600" data-x="4800" class="step">
<h2>課題のディレクトリ構造</h2>

<ul>
<li>lib ➡ モジュール</li>
<li>t ➡ テスト</li>
</ul>

</div>
<div data-y="2400" data-x="0" class="step">
<h2>課題の動作確認</h2>

<ul>
<li>テストが書かれているので，すべて通れば正答です</li>
<li><p>prove コマンドを使ってテストを実行します</p>

<pre><code>$ cd practice/01_module
$ prove -lv t/01_basic.t # テストファイル単体
$ prove -lv t/           # ディレクトリ以下まとめてテスト実行
</code></pre></li>
</ul>

</div>
<div class="step" data-x="1200" data-y="2400">
<h2>課題1 やってみましょう</h2>

<ul>
<li>practice/01_module です</li>
<li>質問はいつでもどうぞ</li>
</ul>

</div>
<div class="step" data-x="2400" data-y="2400">
<h2>モジュールの定義</h2>

</div>
<div data-x="3600" class="step" data-y="2400">
<h2>サブルーチンの定義</h2>

<ul>
<li><p>通常の関数と同じく <code>sub</code> で定義します</p>

<pre><code>package Some::Module;
sub hello{ 'Hello, perl world' }
1;
</code></pre></li>
</ul>

</div>
<div data-y="2400" class="step" data-x="4800">
<h2>サブルーチンの呼び出し</h2>

<ul>
<li>Package名::サブルーチン名で呼び出します</li>
<li><p>クラスメソッドです</p>

<pre><code>Some::Module::hello();
</code></pre></li>
</ul>

</div>
<div data-x="0" class="step" data-y="3200">
<h2>課題2</h2>

<ul>
<li>practice/02_class_method</li>
<li>質問はいつでもどうぞ</li>
</ul>

</div>
<div data-y="3200" data-x="1200" class="step">
<h2>課題2 テスト内容参考</h2>

<ul>
<li>今度の課題はテストの内容見ないと回答できないです</li>
<li>is($got, $expected, $test_name) ➡ 一致していれば ok</li>
</ul>

</div>
<div data-x="2400" class="step" data-y="3200">
<h2>Perl でオブジェクト指向</h2>

<ul>
<li>Perl でもオブジェクト指向できます</li>
</ul>

</div>
<div class="step" data-x="3600" data-y="3200">
<h2>Perlのオブジェクト指向</h2>

</div>
<div data-x="4800" class="step" data-y="3200">
<h2>メソッドの定義</h2>

<ul>
<li>メソッドも関数と同じように定義する</li>
<li>ただし第1引数にオブジェクトを受け取る</li>
<li><p><code>$self</code> で受け取るのが慣習</p>

<pre><code>sub hello_oo {
    my $self = shift;
    return 'Perl oo world';
}
</code></pre></li>
</ul>

</div>
<div class="step" data-x="0" data-y="4000">
<h2>メソッドの呼び出し</h2>

<ul>
<li><p>オブジェクトに対してアロー演算子(->)を使って呼び出す</p>

<pre><code>use Some::Module;
my $module = Some::Module-&gt;new;
$module-&gt;hello_oo; # 'Perl oo world'
</code></pre></li>
</ul>

</div>
<div data-y="4000" class="step" data-x="1200">
<h2>オブジェクトは勝手に生成されるの?</h2>

<ul>
<li>ですよね</li>
</ul>

</div>
<div data-x="2400" class="step" data-y="4000">
<h2>オブジェクトの生成</h2>

<ul>
<li><code>bless</code> でリファレンスにpackage名を結びつけてオブジェクトにします</li>
<li>自分でコンストラクタを作ります</li>
</ul>

</div>
<div data-y="4000" class="step" data-x="3600">
<h2>コンストラクタの定義</h2>

<ul>
<li>コンストラクタの名前は決まってません</li>
<li><p>Perlの慣習では <code>new</code> を使う</p>

<pre><code>package Some::Module;
use strict;
use warnings;
sub new {
    my $class = shift;
    bless +{}, $class;
}
1;
</code></pre></li>
</ul>

</div>
<div data-y="4000" class="step" data-x="4800">
<h2>コンストラクタの定義</h2>

<ul>
<li><code>$class</code> にはmoduleの名前が入っている</li>
<li><code>bless</code> でリファレンスをpackage名と結びつけることでオブジェクトになる</li>
<li><p>ここでは空のハッシュリファレンスをオブジェクト化して返しています</p>

<pre><code>sub new {
    my $class = shift;
    bless +{}, $class;
}
</code></pre></li>
</ul>

</div>
<div data-x="0" class="step" data-y="4800">
<h2>コンストラクタの呼び出し</h2>

<ul>
<li>アロー演算子(->)を使って呼び出す</li>
<li><p>メソッドと同じです</p>

<pre><code>use Some::Module;
my $module = Some::Module-&gt;new;
</code></pre></li>
</ul>

</div>
<div class="step" data-x="1200" data-y="4800">
<h2>アロー演算子って何なの?</h2>

<ul>
<li>ハッシュリファレンスなどの要素へのアクセス</li>
<li><p>メソッド呼び出し時のシュガーシンタックス</p>

<ul>
<li><p>だから第1引数にクラス名やオブジェクトを受け取る</p>

<p>$hash_ref->{name};
$array_ref->[0];
$sub_ref->($params);
my $module = new 'Some::Module';# Some::Module->new
hello_oo $module; # $module->hello_oo</p></li>
</ul></li>
</ul>

</div>
<div data-x="2400" class="step" data-y="4800">
<h2>課題3</h2>

<ul>
<li>practice/03_object です</li>
<li>質問はいつでもどうぞ</li>
</ul>

</div>
<div data-y="4800" class="step" data-x="3600">
<h2>課題3 テスト内容参考</h2>

<ul>
<li>prove -lv t</li>
<li>今度の課題はテストの内容見て回答してください</li>
<li>isa_ok($object, $class) ➡ そのクラスのインスタンスならば ok</li>
</ul>

</div>
<div data-y="4800" class="step" data-x="4800">
<h1>Perl の代表的モジュール</h1>

<ul>
<li>しばらく講義</li>
<li>さらっと流します</li>
</ul>

</div>
<div data-x="0" class="step" data-y="5600">
<h2>CPAN</h2>

<ul>
<li>ほしいものは大抵CPANにあります</li>
<li>他の言語で組み込みで用意されているものも，<br />モジュールとして存在することが多い</li>
<li><a href="https://metacpan.org/">https://metacpan.org/</a> で探せます</li>
</ul>

</div>
<div data-y="5600" data-x="1200" class="step">
<h2><a href="https://metacpan.org/pod/List::Util">List::Util</a>, <a href="https://metacpan.org/pod/List::MoreUtils">List::MoreUtils</a></h2>

<ul>
<li>List 系のユーティリティ</li>
<li>組み込み関数としては，map や grep などしかない</li>
<li>ほしいものはこのあたりにあるかも</li>
</ul>

</div>
<div data-y="5600" class="step" data-x="2400">
<h2><a href="https://metacpan.org/pod/Encode">Encode</a></h2>

<ul>
<li>文字コードを扱うモジュール</li>
</ul>

</div>
<div data-y="5600" class="step" data-x="3600">
<h2><a href="https://metacpan.org/pod/Data::Util">Data::Util</a></h2>

<ul>
<li>データとデータ型のためのユーティリティ集</li>
<li>チェック関数や検証関数など</li>
</ul>

</div>
<div class="step" data-x="4800" data-y="5600">
<h2><a href="https://metacpan.org/pod/Class::Accessor">Class::Accessor</a></h2>

<ul>
<li>アクセサ
<ul>
<li>言語組み込みでは存在しません</li>
</ul></li>
<li><a href="https://metacpan.org/pod/Class::Accessor::Fast">Class::Accessor::Fast</a>, <a href="https://metacpan.org/pod/Class::Accessor::Lite">Class::Accessor::Lite</a> など他にもいろいろ</li>
</ul>

</div>
<div data-y="6400" data-x="0" class="step">
<h2><a href="https://metacpan.org/pod/Moose">Moose</a>/<a href="https://metacpan.org/pod/Mouse">Mouse</a>/<a href="https://metacpan.org/pod/Moo">Moo</a></h2>

<ul>
<li>Perl のモダンなオブジェクト機構
<ul>
<li>オブジェクトの機構ですら Yet Another なものが存在</li>
</ul></li>
<li>Perl に型システムも提供します</li>
<li>Moose の軽量版が，Mouse や Moo です</li>
</ul>

</div>
<div class="step" data-x="1200" data-y="6400">
<h2><a href="https://metacpan.org/pod/DBI">DBI</a></h2>

<ul>
<li>DB のインタフェイス</li>
<li>Perl でDBを扱うときは，大抵このモジュールか，このモジュールを利用したモジュールで扱う</li>
</ul>

</div>
<div data-y="6400" class="step" data-x="2400">
<h2><a href="https://metacpan.org/pod/Cache::Memcached::Fast">Cache::Memcached::Fast</a></h2>

<ul>
<li>Memcached のインタフェイス</li>
</ul>

</div>
<div data-y="6400" class="step" data-x="3600">
<h2>Perl の環境系のしくみ</h2>

</div>
<div data-y="6400" data-x="4800" class="step">
<h2>Perl の環境系のしくみ</h2>

<ul>
<li>他の言語にあるものは，わりとそろってます
<ul>
<li>CPAN/cpanm ➡ gem, pip</li>
<li>PSGI/Plack ➡ Rack, WSGI</li>
<li>Carton ➡ bundler, pip freeze</li>
<li>plenv, perlbrew ➡ rbenv, RVM, virtualenv, pythonz</li>
<li>Minilla ➡ bundle gem</li>
</ul></li>
</ul>

</div>
<div data-x="0" class="step" data-y="7200">
<h2>CPAN/cpanm</h2>

<ul>
<li>モジュールの管理</li>
<li>CPAN: モジュールやソフトウェアを集めたアーカイブサイト</li>
<li><a href="https://metacpan.org/pod/App::cpanminus">cpanm</a>: CPANからモジュールなどをインストールするためのコマンドラインツール
<ul>
<li>github からもインストール可能</li>
</ul></li>
</ul>

</div>
<div data-y="7200" class="step" data-x="1200">
<h2><a href="http://plackperl.org/">PSGI/Plack</a></h2>

<ul>
<li>PSGI: WebフレームワークとWebサーバをつなぐ共通インタフェース</li>
<li>Plack: PSGIユーティリティとリファレンス実装としてのPSGIサーバなど</li>
</ul>

</div>
<div data-x="2400" class="step" data-y="7200">
<h2><a href="https://metacpan.org/pod/Carton">Carton</a></h2>

<ul>
<li>アプリケーションにおけるPerlモジュールの依存関係を管理するコマンドラインツール</li>
<li><em>Carton - Perl module dependency manager (aka Bundler for Perl)</em></li>
</ul>

</div>
<div class="step" data-x="3600" data-y="7200">
<h2><a href="https://github.com/tokuhirom/plenv">plenv</a>, <a href="http://perlbrew.pl/">perlbrew</a></h2>

<ul>
<li>Perl5 のインストール管理ツール</li>
<li>バージョンと環境を切り替えて使える</li>
</ul>

</div>
<div class="step" data-x="4800" data-y="7200">
<h2><a href="https://metacpan.org/pod/Minilla">Minilla</a></h2>

<ul>
<li>CPAN モジュールのオーサリングツール</li>
<li>他には Module::Starter, Dist::Zilla, Dist::Milla などもあります</li>
</ul>

</div>
<div data-x="0" class="step" data-y="8000">
<h1>PSGIアプリ</h1>

<ul>
<li>説明した環境系の仕組みを使ってWebアプリ作成してみます</li>
</ul>

</div>
<div data-x="1200" class="step" data-y="8000">
<h2>cpanm のインストール</h2>

<ul>
<li><p>モジュールの管理ツール</p>

<h1>plenv 使っている場合</h1>

<p>$ plenv install-cpanm</p>

<h1>使ってない場合</h1>

<p>$ curl -L https://cpanmin.us | perl - App::cpanminus</p></li>
</ul>

</div>
<div class="step" data-x="2400" data-y="8000">
<h2>carton のインストール</h2>

<ul>
<li><p>アプリケーションの依存モジュール管理ツール</p>

<p>$ cpanm Carton</p></li>
</ul>

</div>
<div data-y="8000" class="step" data-x="3600">
<h2>minilla のインストール</h2>

<ul>
<li><p>モジュールオーサリングツール</p>

<p>$ cpanm Minilla</p>

<h1>plenv を使っている場合はrehashする必要があるかも</h1>

<p>$ plenv rehash</p></li>
</ul>

</div>
<div data-y="8000" class="step" data-x="4800">
<h2>モジュールのひな形作成</h2>

<pre><code>$ cd practice
$ minil new MyPSGIApp
$ cd MyPSGIApp
</code></pre>

<ul>
<li>中身見てみましょう</li>
<li>CPAN形式と呼ばれるモジュールのファイル構成です</li>
</ul>

</div>
<div data-y="8800" class="step" data-x="0">
<h2>cpanfile の記述</h2>

<ul>
<li>すでに存在している <code>cpanfile</code> に追記します</li>
<li><p>psgi アプリを作るのに必要なモジュールを記述</p>

<pre><code>requires 'Plack';
requires 'Plack::Builder';
</code></pre></li>
</ul>

</div>
<div data-x="1200" class="step" data-y="8800">
<h2>carton の実行</h2>

<pre><code>    $ carton install
</code></pre>

</div>
<div data-y="8800" data-x="2400" class="step">
<h2>app.psgi ファイルの作成</h2>

<ul>
<li><code>app.psgi</code> はPlackサーバの標準のpsgiファイル</li>
<li>もっとも単純なアプリを作ってみます</li>
</ul>

</div>
<div data-y="8800" data-x="3600" class="step">
<h2>app.psgi ファイルの作成</h2>

<pre><code>    use strict;
    use warnings;

    sub {
        [
            '200',
            [ 'Content-Type' =&gt; 'text/plain' ],
            ['Hello, Plack/PSGI world!']
        ]
    };
</code></pre>

</div>
<div class="step" data-x="4800" data-y="8800">
<h2>plackサーバの起動</h2>

<ul>
<li>-r はコードに変更があったときに自動で再起動する機能です</li>
<li><p>-p はport指定です（デフォルトは5000）</p>

<ul>
<li><p>port5000を使ってなければ指定の必要は無いです</p>

<p>$ carton exec plackup -r</p>

<h1>$ carton exec plackup -r -p 5001</h1></li>
</ul></li>
</ul>

</div>
<div data-y="9600" class="step" data-x="0">
<h2>起動したらアクセスしてみて下さい</h2>

<pre><code>    $ open http://localhost:5000/
</code></pre>

<ul>
<li>もっとも単純なPSGIアプリが動きました!</li>
</ul>

</div>
<div data-x="1200" class="step" data-y="9600">
<h2>PSGI について簡単な解説</h2>

<ul>
<li>PSGI = サーバとアプリのやり取りの取り決め</li>
<li>アプリはレスポンスとして http response, header, body をarrayリファレンスで返す</li>
<li>plackup は，レスポンスを返すサブルーチンを受け取って動作する</li>
</ul>

</div>
<div data-y="9600" class="step" data-x="2400">
<h2>plack middleware</h2>

<ul>
<li>アプリを包んで，リクエストやレスポンスに変更を加えたりする</li>
</ul>

<p><img src="http://pylons-webframework.readthedocs.org/en/latest/_images/pylons_as_onion.png" alt="onion" /></p>

</div>
<div data-y="9600" class="step" data-x="3600">
<h2>plack middleware を使ってみる</h2>

</div>
<div data-x="4800" class="step" data-y="9600">
<h2>cpanfile に追記</h2>

<pre><code>    require 'Plack::Builder'
    require 'Plack::Middleware::Debug'
</code></pre>

<ul>
<li>追記したら carton install してください</li>
</ul>

</div>
<div data-x="0" class="step" data-y="10400">
<h2>app.psgi を編集</h2>

<pre><code>    use strict;
    use warnings;

    use Plack::Builder;

    builder {
        enable 'Debug';
        sub {
            [
                '200',
                [ 'Content-Type' =&gt; 'text/plain' ],
                ['Hello, Plack/PSGI world!']
            ]
        }
    };
</code></pre>

</div>
<div data-y="10400" class="step" data-x="1200">
<h2>開いてみる</h2>

<ul>
<li>保存したら再起動するはずなのでブラウザリロードしてみて下さい</li>
<li>右側にデバッグコンソールが表示されたはずです</li>
</ul>

</div>
<div data-y="10400" class="step" data-x="2400">
<h2>実際にアプリを開発する</h2>

<ul>
<li>そのときはWAFを使うことが多いです</li>
<li>Mojolicious とか Amon2 とか</li>
</ul>

</div>
<div data-x="3600" class="step" data-y="10400">
<h2>以上講義は終わりです</h2>

<ul>
<li>質問とかあれば</li>
</ul>

</div>
<div data-x="4800" class="step" data-y="10400">
<h1>extra 演習</h1>

<ul>
<li>時間があれば</li>
<li>テストが通るように修正して下さい
<ul>
<li>practice/p5-Math-ConsumptionTax-JP</li>
<li>practice/p5-List-Group</li>
<li>practice/p5-String-Inflector</li>
</ul></li>
</ul>

</div>
<div class="step" data-x="0" data-y="11200">
<h1>Perl実習終わり</h1>

<ul>
<li>いつでも質問受け付けます</li>
<li>興味があればPerl勉強会などもやりますよ
<ul>
<li>Perl使う部署に配属してしまったのでしょうがなくとかでももちろんok</li>
</ul></li>
</ul>

</div>


    <div id="overview" class="step" data-x="3000" data-y="1500" data-scale="10">
    </div>

</div>

<div class="hint">
    <p>Use a spacebar or arrow keys to navigate</p>
</div>
<script>
if ("ontouchstart" in document.documentElement) { 
    document.querySelector(".hint").innerHTML = "<p>Tap on the left or right to navigate</p>";
}
</script>
<script src="js/impress.js"></script>
<script>
if ( !window.location.search.match(/print/) ) {
    impress().init();
}
</script>
<script>
var codeTags = document.getElementsByTagName("code");
for (var i = 0; i < codeTags.length; i++) {
    codeTags[i].className = "prettyprint";
}
</script>

</body>
</html>

